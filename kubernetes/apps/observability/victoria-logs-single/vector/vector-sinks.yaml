---
sinks:
  exporter:
    type: prometheus_exporter
    address: 0.0.0.0:9090
    inputs: [internal_metrics]

  vlogs:
    type: elasticsearch
    inputs:
    - default_parser
    - kometa_parser
    - qbittorrent_parser
    - cloudflare_tunnel_parser
    mode: bulk
    api_version: v8
    compression: gzip
    healthcheck:
      enabled: false
    # Buffer configuration for memory optimization
    buffer:
      type: memory
      max_events: 10000
      when_full: drop_newest
    # Batch settings for memory efficiency
    batch:
      max_bytes: 1048576 # 1MB
      timeout_secs: 5
    request:
      headers:
        VL-Time-Field: timestamp
        VL-Stream-Fields: stream,kubernetes.pod_name,kubernetes.container_name,kubernetes.pod_namespace,app
        VL-Msg-Field: message,msg,_msg,log.msg,log.message,log
        AccountID: "0"
        ProjectID: "0"
    endpoints:
    - http://victoria-logs-single:9428/insert/elasticsearch/
