---
# yaml-language-server: $schema=https://raw.githubusercontent.com/victoriametrics/operator/master/config/crd/bases/operator.victoriametrics.com_vmalertmanagerconfigs.yaml
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlertmanagerConfig
metadata:
  name: discord-alerts
spec:
  route:
    receiver: discord-webhook
    group_by: [alertname, cluster, service]
    group_wait: 30s
    group_interval: 5m
    repeat_interval: 12h
    routes:
    - receiver: discord-webhook-critical
      matchers:
      - severity = "critical"
      group_wait: 10s
      repeat_interval: 5m
    - receiver: discord-webhook
      matchers:
      - severity =~ "warning|info"

  receivers:
  - name: discord-webhook
    webhook_configs:
    - url_secret:
        name: discord-webhook-secret
        key: webhook-url
      send_resolved: true

  - name: discord-webhook-critical
    webhook_configs:
    - url_secret:
        name: discord-webhook-secret
        key: webhook-url
      send_resolved: true
