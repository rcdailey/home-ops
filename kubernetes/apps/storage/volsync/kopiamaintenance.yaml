# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/volsync.backube/kopiamaintenance_v1alpha1.json
---
apiVersion: volsync.backube/v1alpha1
kind: KopiaMaintenance
metadata:
  name: daily
spec:
  enabled: true
  # 6 hours - allows completion when repository is degraded with many index blobs
  activeDeadlineSeconds: 21600
  trigger:
    schedule: "0 */8 * * *"
  repository:
    repository: volsync-maintenance-secret
  # Match ReplicationSource moverSecurityContext to prevent UID mismatch on NFS
  # Without this, maintenance jobs run as root (UID 0) creating files that
  # ReplicationSource jobs (UID 1000) cannot read
  successfulJobsHistoryLimit: 1
  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    fsGroupChangePolicy: OnRootMismatch
