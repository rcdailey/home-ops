# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/v1/secret.json
---
apiVersion: v1
kind: Secret
metadata:
  name: ${APP}-volsync-secret
type: Opaque
stringData:
  # Kopia repository password - each app gets unique repo
  KOPIA_PASSWORD: ${APP}-volsync-backup-password
  # S3 configuration - using your existing Garage S3
  AWS_ACCESS_KEY_ID: ${S3_ACCESS_KEY_ID}
  AWS_SECRET_ACCESS_KEY: ${S3_SECRET_ACCESS_KEY}
  AWS_DEFAULT_REGION: ${S3_REGION}
  # Kopia S3 specific settings - connection only (not path configuration)
  KOPIA_S3_ENDPOINT: ${S3_ENDPOINT}
  KOPIA_S3_DISABLE_TLS: "true"
  # Repository URL - full S3 path with app-specific prefix
  # Using ONLY KOPIA_REPOSITORY method to avoid mixing S3 configuration approaches
  # Previous KOPIA_S3_BUCKET removed to eliminate ambiguous path resolution
  # CRITICAL: Trailing slash required to treat as directory (not object prefix)
  KOPIA_REPOSITORY: s3://volsync-backups/${APP}/
