---
# Comprehensive e1000e driver tuning for Intel I219-V on nami (192.168.1.50)
#
# Problem: Intel I219-V network adapter experiencing packet drops under high Ceph
# storage traffic load, triggering CephNodeNetworkPacketDrops alert.
#
# Root Causes:
# 1. Default ring buffers (256) too small for high-throughput storage workloads
# 2. Known e1000e driver bugs with TSO/GSO/GRO hardware offload features
#
# Solution: Increase ring buffers and disable problematic offload features
#
# References:
# - https://forum.proxmox.com/threads/e1000e-reset-adapter-unexpectedly.87769/
# - https://bugzilla.kernel.org/show_bug.cgi?id=213377
# - https://www.talos.dev/v1.11/talos-guides/network/ethernet-config/
# - onedr0p homelab community recommendation
# - buroa k8s-gitops implementation pattern
apiVersion: v1alpha1
kind: EthernetConfig
name: eno1
rings:
  rx: 4096  # Increase from default 256 to maximum 4096 (16x larger)
  tx: 4096  # Prevents buffer exhaustion during Ceph traffic bursts
features:
  tx-tcp-segmentation: false      # TSO - Disable to prevent e1000e driver bugs
  tx-generic-segmentation: false  # GSO - Disable to prevent adapter resets
  rx-gro: false                   # GRO - Disable to prevent packet drops
  rx-vlan-hw-parse: false         # VLAN RX - Disable to prevent drops with VLANs/bridges
