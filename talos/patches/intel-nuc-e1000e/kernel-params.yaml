---
# Kernel parameters for Intel I219-V stability on Intel NUCs
#
# NOTE: This file is NOT CURRENTLY APPLIED due to systemd-boot/UKI limitations
#
# Talos 1.10+ uses systemd-boot with UKI (Unified Kernel Images) on UEFI systems.
# With UKI, kernel arguments are embedded in the image and machine.install.extraKernelArgs
# is ignored. Kernel params cannot be modified without upgrading the UKI itself.
#
# Reference: https://www.talos.dev/v1.11/talos-guides/install/bare-metal-platforms/bootloader/
#
# This file is preserved for documentation of the C-State issue, but ethernet-tuning.yaml
# alone resolved packet drops without requiring kernel parameter changes.
#
# Original Problem: Intel e1000e driver can cause "Detected Hardware Unit Hang" errors
# and complete system lockups when network adapter enters deep CPU power states.
#
# Intended Solution: Limit CPU C-State to prevent deep sleep states that cause e1000e hangs
#
# Trade-off: Slightly higher power consumption, but prevents network and system freezes
#
# References:
# - https://askubuntu.com/questions/1376155/intel-i219-experiencing-huge-package-loss
# - https://bbs.archlinux.org/viewtopic.php?id=255162
# - Community reports of e1000e "hardware unit hang" errors
machine:
  install:
    extraKernelArgs:
      - intel_idle.max_cstate=1
