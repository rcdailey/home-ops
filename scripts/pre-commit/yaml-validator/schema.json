{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/home-ops/yaml-validator/schema.json",
  "title": "YAML Validator Configuration",
  "description": "Configuration schema for Kubernetes YAML validation rules",
  "type": "object",
  "properties": {
    "rules": {
      "type": "array",
      "description": "Array of validation rules to apply to YAML files",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Human-readable name for the validation rule"
          },
          "applies_to": {
            "type": "object",
            "description": "Criteria for when this rule applies to a document",
            "properties": {
              "kind": {
                "type": "string",
                "description": "Kubernetes resource kind that this rule applies to",
                "examples": ["Kustomization", "HelmRelease", "Deployment", "Service"]
              }
            },
            "required": ["kind"],
            "additionalProperties": false
          },
          "conditions": {
            "type": "array",
            "description": "Unconditional validation requirements that must be met",
            "items": {
              "$ref": "#/$defs/condition"
            }
          },
          "when": {
            "type": "array",
            "description": "Conditional checks - if all pass, then 'then' conditions are evaluated",
            "items": {
              "$ref": "#/$defs/condition"
            }
          },
          "then": {
            "type": "array",
            "description": "Conditions to check only when all 'when' conditions are met",
            "items": {
              "$ref": "#/$defs/condition"
            }
          }
        },
        "required": ["name", "applies_to"],
        "anyOf": [
          {"required": ["conditions"]},
          {"allOf": [{"required": ["when"]}, {"required": ["then"]}]}
        ],
        "additionalProperties": false
      }
    }
  },
  "required": ["rules"],
  "additionalProperties": false,
  "$defs": {
    "condition": {
      "type": "object",
      "description": "A single validation condition using JSONPath",
      "properties": {
        "path": {
          "type": "string",
          "description": "JSONPath expression to locate the value in the YAML document",
          "examples": [
            "$.spec.values.controllers.*.annotations['reloader.stakater.com/auto']",
            "$.generatorOptions.disableNameSuffixHash",
            "$.spec.chartRef.name"
          ]
        },
        "value": {
          "description": "Expected value at the JSONPath location (any JSON type)",
          "examples": [true, "app-template", "LoadBalancer", 1, ["item1", "item2"]]
        }
      },
      "required": ["path"],
      "additionalProperties": false
    }
  }
}
