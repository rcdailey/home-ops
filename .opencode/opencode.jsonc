{
  "$schema": "https://opencode.ai/config.json",
  "formatter": {
    "yamlfmt": {
      "command": ["yamlfmt", "$FILE"],
      "extensions": [".yaml", ".yml"]
    },
    "shfmt": {
      "disabled": true
    }
  },
  "permission": {
    "bash": {
      // kubectl - ALLOW (read-only inspection)
      "kubectl exec*": "allow",

      // kubectl - DENY (hard block, GitOps only)
      "kubectl apply*": "deny",
      "kubectl create*": "deny",
      "kubectl edit*": "deny",
      "kubectl replace*": "deny",
      "kubectl label*": "deny",
      "kubectl taint*": "deny",
      "kubectl cordon*": "deny",
      "kubectl uncordon*": "deny",
      "kubectl port-forward*": "deny",

      // kubectl - ASK (sometimes needed, prompt for approval)
      "kubectl delete*": "ask",
      "kubectl patch*": "ask",
      "kubectl rollout*": "ask",
      "kubectl rollout history*": "allow",
      "kubectl scale*": "ask",
      "kubectl annotate*": "ask",
      "kubectl drain*": "ask",

      // talosctl - DENY (infrastructure mutations)
      "talosctl apply-config*": "deny",
      "talosctl upgrade*": "deny",
      "talosctl reset*": "deny",
      "talosctl reboot*": "deny",
      "talosctl shutdown*": "deny",
      "talosctl patch*": "deny",
      "talosctl edit*": "deny",
      "talosctl bootstrap*": "deny",
      "talosctl kubeconfig*": "deny",

      // flux - DENY (infrastructure mutations)
      "flux install*": "deny",
      "flux uninstall*": "deny",
      "flux bootstrap*": "deny",
      "flux delete*": "deny",

      // flux - ASK (debugging/operations)
      "flux suspend*": "ask",
      "flux resume*": "ask",

      // helm - DENY (bypasses GitOps)
      "helm install*": "deny",
      "helm upgrade*": "deny",
      "helm uninstall*": "deny",
      "helm rollback*": "deny",

      // task/just - DENY (infrastructure operations)
      "task *": "deny",
      "just *": "deny"
    }
  }
}
