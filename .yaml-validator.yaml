# yaml-language-server: $schema=scripts/pre-commit/yaml-validator/schema.json
rules:
  - name: ConfigMap generators must disable hash suffixes
    applies_to:
      kind: Kustomization
    when:
      - path: $.configMapGenerator
    then:
      - path: $.generatorOptions.disableNameSuffixHash
        value: true

  - name: HelmRelease with app-template must have reloader annotation
    applies_to:
      kind: HelmRelease
    when:
      - path: $.spec.chartRef.name
        value: app-template
    then:
      - path: $.spec.values.controllers.*.annotations['reloader.stakater.com/auto']
        value: "true"
